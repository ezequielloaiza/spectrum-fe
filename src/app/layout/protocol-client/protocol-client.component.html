<div class="container bootstrap snippet pl-5 pr-3">
  <div class="row">
    <ngb-tabset (tabChange)="beforeChange($event)">
      <!--Manage All-->
      <ngb-tab id="{{'manage-all'}}">
        <ng-template ngbTabTitle><b>{{ 'Manage All' }}</b></ng-template>
        <ng-template ngbTabContent>
          <div class="border-tab" [formGroup]="protocolForm">
            <div class="text-right pb-3">
              <button type="button" class="btn btn-main mr-3" *ngIf="!edit" (click)="enableEdit()">{{ 'Edit' | translate }}
                <i class="fa fa-edit"></i>
              </button>
              <button type="button" class="btn btn-secondary mr-3" [disabled]="saving" *ngIf="edit" (click)="cleanChanges()">{{ 'Cancel' | translate }}&nbsp;
                <i class="fa fa-times"></i>
              </button>
              <button type="button" class="btn btn-main" *ngIf="edit" [disabled]="saving" (click)="updateManageAll()">{{ 'Save' | translate }}&nbsp;
                <i class="fa fa-save"></i>
              </button>
            </div>
            
            <!--Manage all-->
            <div class="row" *ngFor="let protocol of protocols">
              <div class="w-100 border-protocol p-3 mb-3">
                <div class="d-flex w-100 border-bottom">
                  <div class="w-50 mr-3">
                    <span class="font-weight-bold">{{ protocol.label | translate }}</span>
                  </div>
                  <div class="w-46">
                    <span class="font-weight-bold">{{ "Supplier" | translate }}</span>
                  </div>
                </div>
            
                <div class="d-flex align-items-center w-100 pt-2 pb-1" *ngFor="let value of protocol.values; let pos = index">
                  <div class="w-50 mr-3">
                    <div class="input-value">
                      <input
                        *ngIf="
                          protocol.label === 'Recipient' ||
                          protocol.label === 'Shipping Method' ||
                          protocol.label === 'Account Number for Shipping Carrier'
                        "
                        type="text"
                        class="form-control"
                        placeholder="{{ protocol.placeHolder | translate }}"
                        [(ngModel)]="value.content"
                        [ngModelOptions]="{standalone: true}"
                        [disabled]="!edit"
                      />
                      <textarea
                        *ngIf="
                          protocol.label === 'Shipping Address' ||
                          protocol.label === 'Comments' ||
                          protocol.label === 'Shipping Details'
                        "
                        style="overflow-x: hidden;"
                        type="text"
                        class="form-control"
                        placeholder="{{ protocol.placeHolder | translate }}"
                        [(ngModel)]="value.content"
                        [ngModelOptions]="{standalone: true}"
                        [disabled]="!edit"
                      ></textarea>
            
                      <!--Shipping Frecuency-->
                      <div *ngIf="protocol.label === 'Shipping Frecuency'" class="mb-2 mr-sm-2 mb-sm-0 d-flex align-items-center">
                        <div class="custom-control-inline">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              id="{{ 'customRadioM' + pos }}"
                              name="{{ 'shippingFrecuency' + pos }}"
                              class="custom-control-input"
                              (change)="assignShippingFrecuency(protocol, 1, pos)"
                              [checked]="value.content === 'Monthly'"
                              [disabled]="!edit"
                            />
                            <label
                              class="custom-control-label"
                              for="{{ 'customRadioM' + pos }}"
                              >{{ "Monthly" | translate }}</label
                            >
                          </div>
                          <div
                            style="margin-left: 10px;"
                            class="custom-control custom-radio"
                          >
                            <input
                              type="radio"
                              id="{{ 'customRadioB' + pos }}"
                              name="{{ 'shippingFrecuency' + pos }}"
                              class="custom-control-input"
                              (change)="assignShippingFrecuency(protocol, 2, pos)"
                              [checked]="value.content === '15' || value.content === '30'"
                              [disabled]="!edit"
                            />
                            <label
                              class="custom-control-label"
                              for="{{ 'customRadioB' + pos }}"
                              >{{ "Biweekly" | translate }}</label
                            >
                          </div>
                          <div
                            style="margin-left: 10px;"
                            class="custom-control custom-radio"
                          >
                            <input
                              type="radio"
                              id="{{ 'customRadioW' + pos }}"
                              name="{{ 'shippingFrecuency' + pos }}"
                              class="custom-control-input"
                              (change)="assignShippingFrecuency(protocol, 3, pos)"
                              [checked]="value.content !== 'Monthly' && value.content !== '15' && value.content !== '30' && value.content !== '' "
                              [disabled]="!edit"
                            />
                            <label
                              class="custom-control-label"
                              for="{{ 'customRadioW' + pos }}"
                              >{{ "Weekly" | translate }}</label
                            >
                          </div>
                        </div>
                        <!--<span>{{ shippingFrecuency.value }}</span>-->
                        <select
                          *ngIf="value.showB === 'true'"
                          [(ngModel)]="value.content"
                          [ngModelOptions]="{standalone: true}"
                          class="form-control"
                          name="{{ 'shippingFrecuencyB' + pos }}"
                          [disabled]="!edit"
                        >
                          <option value="" [selected]="true" translate>Select value</option>
                          <option
                            *ngFor="let biweekly of listBiweekly"
                            value="{{ biweekly }}"
                            >{{ biweekly | translate }}</option
                          >
                        </select>
                        <select
                          *ngIf="value.showW === 'true'"
                          [(ngModel)]="value.content"
                          [ngModelOptions]="{standalone: true}"
                          class="form-control"
                          name="{{ 'shippingFrecuencyW' + pos }}"
                          [disabled]="!edit"
                        >
                          <option value="" [selected]="true" translate>Select value</option>
                          <option *ngFor="let weekly of listWeekly" value="{{ weekly }}">{{
                            weekly | translate
                          }}</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="w-46">
                    <div class="d-inline-block w-100" ngbDropdown autoClose="outside">
                      <button
                        class="btn border-type w-100 text-left"
                        ngbDropdownToggle
                        required
                        [disabled]="!validContent(protocol,pos) || !edit"
                      >
                        <div class="text-overflow">{{ getNamesTypeList(value) }}</div>
                        <span class="tcs-text-overflow" *ngIf="checkSuppliers(protocol,pos)">
                          {{ "Select At Least a Supplier" | translate }}
                        </span>
                      </button>
                      <ul
                        ngbDropdownMenu
                        class="w-100 p-3 dropdown-list"
                        aria-labelledby="dropdownManual"
                      >
                        <div class="select-type">
                          <li *ngFor="let supplier of suppliers; index as i">
                            <div>
                              <div class="custom-control custom-checkbox" data-toggle="tooltip" data-placement="left" title="{{ 'If it is disabled, it was previously selected' | translate }}">
                                <input attr.id="{{protocol.label}}-{{ i }}-{{ pos }}"
                                  type="checkbox" name="checkboxGroupAll"
                                  [checked]="checkedSupplier(protocol, value, supplier)"
                                  (click)="selectSupplier(supplier.idSupplier, protocol, value)"
                                  class="custom-control-input"
                                  [disabled]="disabledSupplier(protocol, value, supplier) || !edit"
                                />
                                <label
                                  class="custom-control-label"
                                  for="{{ protocol.label }}-{{ i }}-{{ pos }}"
                                ></label>
            
                                <span class="tcs-text-overflow">
                                  {{ supplier.companyName | titlecase }}
                                </span>
                              </div>
                            </div>
                          </li>
                        </div>
                      </ul>
                    </div>
                  </div>
                  <div class="trash" [hidden]="protocol.values.length === 1 || !edit">
                    <span
                      class="fa fa-trash"
                      [ngClass]="{
                        top:
                          protocol.label === 'Shipping Address' ||
                          protocol.label === 'Comments' ||
                          protocol.label === 'Shipping Details'
                      }"
                      placement="top"
                      ngbTooltip="{{ 'Delete protocol value' | translate }}"
                      (click)="removeValue(protocol, pos)"
                    ></span>
                  </div>
                </div>
                <div>
                  <button type="button" class="btn btn-main" 
                          [hidden]="suppliers.length === protocol.selectedSuppliers.length || protocol.values.length === suppliers.length || !edit"
                          (click)="addValue(protocol)">{{ 'Add' | translate }}
                    <i class="fa fa-plus-circle ml-2"></i>
                  </button>
                </div>
              </div>
            </div>
            <!-- End manage all-->

            <div class="text-right pb-3">
              <button type="button" class="btn btn-secondary mr-3" [disabled]="saving" *ngIf="edit" (click)="cancel()">{{ 'Cancel' | translate }}&nbsp;
                <i class="fa fa-times"></i>
              </button>
              <button
                type="button"
                class="btn btn-main"
                *ngIf="edit"
                [disabled]="saving"
                (click)="update()"
              >{{ 'Save' | translate }}&nbsp;
                <i class="fa fa-save"></i>
              </button>
            </div>
          </div>
        </ng-template>
      </ngb-tab>
      <ngb-tab id="{{supplier.idSupplier}}" *ngFor="let supplier of suppliers">
        <ng-template ngbTabTitle><b>{{ supplier.companyName}}</b></ng-template>
        <ng-template ngbTabContent>
          <div class="border-tab" [formGroup]="protocolForm">
            <div class="text-right pb-3">
              <button type="button" class="btn btn-main mr-3" *ngIf="!edit" (click)="enableEdit()">{{ 'Edit' | translate }}
                <i class="fa fa-edit"></i>
              </button>
              <button type="button" class="btn btn-success btn-xs" *ngIf="!edit" [disabled]="!download" (click)="downloadProtocol()">{{ 'Download PDF' | translate }}
                <i class="fa fa-download"></i>
              </button>
            </div>
            <div class="d-flex">
              <div class="form-group pr-3 half-flex">
                <label>{{ 'ACC Number' | translate }}</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="accNumber"
                  maxlength="120"
                  *ngIf="false"
                />
                <div class="truncate">
                  <span [ngClass]="{ unassigned: !protocol.accNumber }">{{ protocol.accNumber ? protocol.accNumber :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Country' | translate }}</label>
                <div>
                  <ng-select
                    [items]="countries"
                    [searchable]="true"
                    bindValue="idCountry"
                    bindLabel="name"
                    formControlName="country"
                    *ngIf="false"
                  >
                  </ng-select>
                </div>
                <div class="truncate" *ngIf="true">
                  <span [ngClass]="{ unassigned: !protocol.countryName }">{{ protocol.countryName ? protocol.countryName :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
            </div>
            <div class="d-flex">
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Business Name' | translate}}</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="businessName"
                  maxlength="120"
                  *ngIf="false"
                  placeholder="{{ 'Enter business name' | translate }}"
                />
                <div class="truncate" *ngIf="true">
                  <span [ngClass]="{ unassigned: !protocol.businessName }">{{ protocol.businessName ? protocol.businessName :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Recipient' | translate }}</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="recipient"
                  maxlength="120"
                  *ngIf="edit"
                  placeholder="{{ 'Enter recipient' | translate }}"
                />
                <div class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.recipient }">{{ protocol.recipient ? protocol.recipient :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
            </div>
            <div class="d-flex">
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Shipping Address' | translate }}</label>
                <textarea style="overflow-x: hidden;"
                  type="text"
                  class="form-control"
                  formControlName="shippingAddress"
                  maxlength="254"
                  *ngIf="edit"
                  placeholder="{{ 'Enter shipping address' | translate }}">
                </textarea>
                <div class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.shippingAddress }">{{ protocol.shippingAddress ? protocol.shippingAddress :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Shipping Frecuency' | translate }}</label>
                <div *ngIf="edit" class="mb-2 mr-sm-2 mb-sm-0">
                  <div class="custom-control-inline">
                    <div class="custom-control custom-radio">
                      <input type="radio" id="customRadio1" name="shippingFrecuency" class="custom-control-input" (change)="assignShippingFrecuency(protocol, 1, pos)" [checked]="valueFrecuency === 'Monthly'">
                      <label class="custom-control-label" for="customRadio1">{{ 'Monthly' | translate }}</label>
                    </div>
                    <div style="margin-left: 10px;" class="custom-control custom-radio">
                      <input type="radio" id="customRadio2" name="shippingFrecuency" class="custom-control-input" (change)="assignShippingFrecuency(protocol, 2, pos)" [checked]="valueFrecuency === 'Biweekly'">
                      <label class="custom-control-label" for="customRadio2">{{ 'Biweekly' | translate }}</label>
                    </div>
                    <div style="margin-left: 10px;" class="custom-control custom-radio">
                      <input type="radio" id="customRadio3" name="shippingFrecuency" class="custom-control-input" (change)="assignShippingFrecuency(protocol, 3, pos)" [checked]="valueFrecuency === 'Weekly'">
                      <label class="custom-control-label" for="customRadio3">{{ 'Weekly' | translate }}</label>
                    </div>
                  </div>
                  <!--<span>{{ shippingFrecuency.value }}</span>-->
                  <select
                    *ngIf="valueFrecuency === 'Biweekly'"
                    class="form-control"
                    name="shippingFrecuencyB"
                    formControlName="shippingFrecuencyB">
                      <option *ngFor="let biweekly of listBiweekly" value="{{biweekly}}">{{ biweekly | translate }}</option>
                  </select>
                  <select
                    *ngIf="valueFrecuency === 'Weekly'"
                    class="form-control"
                    name="shippingFrecuencyW"
                    formControlName="shippingFrecuencyW">
                      <option *ngFor="let weekly of listWeekly" value="{{weekly}}">{{ weekly | translate }}</option>
                  </select>
                </div>
                <div  class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.shippingFrecuency }" translate>{{ protocol.shippingFrecuency ? protocol.shippingFrecuency :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
            </div>
            <div class="d-flex">
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Shipping Method' | translate }}</label>
                <select
                *ngIf="edit"
                class="form-control"
                name="shippingMethod"
                formControlName="shippingMethod">
                  <option *ngFor="let shippingMethod of listShippingMethod" value="{{shippingMethod}}">{{ shippingMethod | translate }}</option>
                </select>
                <div class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.shippingMethod }">{{ protocol.shippingMethod ? protocol.shippingMethod :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Shipping Details' | translate }}</label>
                <textarea style="overflow-x: hidden;"
                type="text"
                class="form-control"
                formControlName="shippingDetail"
                maxlength="254"
                *ngIf="edit"
                placeholder="{{ 'Enter shipping detail' | translate }}"
                ></textarea>
                <div  class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.shippingDetail }">{{ protocol.shippingDetail ? protocol.shippingDetail :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
            </div>
            <div class="d-flex">
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Account Number for Shipping Carrier' | translate }}</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="accountNumber"
                  maxlength="120"
                  *ngIf="edit"
                  placeholder="{{ 'Enter account number for shipping carrier' | translate }}"
                />
                <div class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.accountNumber }">{{ protocol.accountNumber ? protocol.accountNumber :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
              <div class="form-group pr-3 half-flex">
                <label>{{ 'Comments' | translate }}</label>
                <textarea style="overflow-x: hidden;"
                type="text"
                class="form-control"
                formControlName="comment"
                maxlength="254"
                *ngIf="edit"
                placeholder="{{ 'Enter comments' | translate }}"
              ></textarea>
                <div  class="truncate" *ngIf="!edit">
                  <span [ngClass]="{ unassigned: !protocol.comment }">{{ protocol.comment ? protocol.comment :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
            </div>
            <div class="d-flex">

              <div class="form-group pr-3 half-flex">
                <label *ngIf="false">{{ 'DMV' | translate }}</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="dmv"
                  maxlength="120"
                  *ngIf="false"
                />
                <div class="truncate" *ngIf="false">
                  <span [ngClass]="{ unassigned: !protocol.dmv }">{{ protocol.dmv ? protocol.dmv :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
              <div class="form-group pr-3 half-flex">
                <label *ngIf="false">{{ 'Email Comments' | translate }}</label>
                 <textarea style="overflow-x: hidden;"
                 *ngIf="false"
                  type="text"
                  class="form-control"
                  formControlName="emailComment"
                  maxlength="254"
                  placeholder="{{ 'Enter email comments' | translate }}"
                ></textarea>
                <div  class="truncate" *ngIf="false">
                  <span [ngClass]="{ unassigned: !protocol.emailComment }">{{ protocol.emailComment ? protocol.emailComment :
                    'Unassigned' | translate
                  }}</span>
                </div>
              </div>
            </div>
            <div class="text-right pb-3">
              <button type="button" class="btn btn-secondary mr-3" [disabled]="saving" *ngIf="edit" (click)="cancel()">{{ 'Cancel' | translate }}&nbsp;
                <i class="fa fa-times"></i>
              </button>
              <button type="button" class="btn btn-main" *ngIf="edit" [disabled]="saving" (click)="update()">{{ 'Save' | translate }}&nbsp;
                <i class="fa fa-save"></i>
              </button>
            </div>
          </div>
        </ng-template>
      </ngb-tab>
    </ngb-tabset>
  </div>
</div>

